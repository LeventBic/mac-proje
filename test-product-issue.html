<!DOCTYPE html>
<html>
<head>
    <title>ÃœrÃ¼n 123 Silme Sorunu Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” ÃœrÃ¼n 123 Silme Sorunu Analizi</h1>
    
    <div class="section">
        <h2>ğŸ“Š Mevcut Durum Analizi</h2>
        <div class="result">
            <strong>Bulgular:</strong><br>
            âœ… Backend API Ã§alÄ±ÅŸÄ±yor<br>
            âœ… ÃœrÃ¼n listesi doÄŸru geliyor (ID 1-8 arasÄ±)<br>
            âœ… ID 123 veritabanÄ±nda yok<br>
            âœ… Mevcut Ã¼rÃ¼n silme iÅŸlemi Ã§alÄ±ÅŸÄ±yor<br>
            âš ï¸ Backend loglarÄ±nda ID 18'e DELETE isteÄŸi var (123 deÄŸil)<br>
            â“ Frontend'de ID 123'Ã¼n nereden geldiÄŸi belirsiz
        </div>
    </div>
    
    <div class="section">
        <h2>ğŸ§ª Test AdÄ±mlarÄ±</h2>
        <button onclick="testCurrentProducts()">1. Mevcut ÃœrÃ¼nleri Listele</button>
        <button onclick="testDelete123()">2. ID 123 Silmeyi Test Et</button>
        <button onclick="testDeleteExisting()">3. Mevcut ÃœrÃ¼n Silmeyi Test Et</button>
        <button onclick="openFrontend()">4. Frontend'i AÃ§</button>
        <div id="testResults"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ”§ Ã‡Ã¶zÃ¼m Ã–nerileri</h2>
        <div class="result">
            <strong>OlasÄ± Nedenler:</strong><br>
            1. Frontend cache'inde eski veri<br>
            2. React Query cache'inde yanlÄ±ÅŸ ID<br>
            3. Frontend state'inde hatalÄ± ID<br>
            4. URL parametresinde yanlÄ±ÅŸ ID<br>
            5. Component prop'larÄ±nda hatalÄ± ID geÃ§iÅŸi
        </div>
        <button onclick="clearAllCache()">Cache'leri Temizle</button>
        <button onclick="debugFrontend()">Frontend Debug Bilgileri</button>
    </div>
    
    <div class="section">
        <h2>ğŸ“ Debug Bilgileri</h2>
        <div id="debugInfo"></div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:3002/api';
        let authToken = null;
        
        async function getAuthToken() {
            if (authToken) return authToken;
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'levent2', password: '20202020' })
                });
                const data = await response.json();
                authToken = data.token;
                return authToken;
            } catch (error) {
                console.error('Auth error:', error);
                return null;
            }
        }
        
        async function testCurrentProducts() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>ğŸ”„ ÃœrÃ¼nler yÃ¼kleniyor...</p>';
            
            try {
                const token = await getAuthToken();
                const response = await fetch(`${API_BASE}/products?status=all`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                const products = data.data?.products || [];
                const productList = products.map(p => 
                    `ID: ${p.id}, Name: ${p.name}, Active: ${p.is_active}`
                ).join('<br>');
                
                resultsDiv.innerHTML = `
                    <div class="result success">
                        <strong>âœ… Toplam ${products.length} Ã¼rÃ¼n bulundu:</strong><br>
                        ${productList}<br><br>
                        <strong>ID AralÄ±ÄŸÄ±:</strong> ${Math.min(...products.map(p => p.id))} - ${Math.max(...products.map(p => p.id))}
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ Hata: ${error.message}</div>`;
            }
        }
        
        async function testDelete123() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>ğŸ”„ ID 123 silme testi...</p>';
            
            try {
                const token = await getAuthToken();
                const response = await fetch(`${API_BASE}/products/123`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <div class="result ${response.ok ? 'success' : 'error'}">
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Mesaj:</strong> ${data.message || 'Bilinmeyen yanÄ±t'}<br>
                        <strong>SonuÃ§:</strong> ${response.ok ? 'âœ… BaÅŸarÄ±lÄ±' : 'âŒ BaÅŸarÄ±sÄ±z (beklenen)'}
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ Hata: ${error.message}</div>`;
            }
        }
        
        async function testDeleteExisting() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>ğŸ”„ Mevcut Ã¼rÃ¼n silme testi...</p>';
            
            try {
                const token = await getAuthToken();
                // Ã–nce Ã¼rÃ¼nleri al
                const productsResponse = await fetch(`${API_BASE}/products?status=all`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const productsData = await productsResponse.json();
                const activeProducts = productsData.data?.products?.filter(p => p.is_active) || [];
                
                if (activeProducts.length === 0) {
                    resultsDiv.innerHTML = '<div class="result error">âŒ Silinecek aktif Ã¼rÃ¼n bulunamadÄ±</div>';
                    return;
                }
                
                const productToDelete = activeProducts[0];
                
                // ÃœrÃ¼nÃ¼ sil
                const deleteResponse = await fetch(`${API_BASE}/products/${productToDelete.id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const deleteData = await deleteResponse.json();
                
                resultsDiv.innerHTML = `
                    <div class="result ${deleteResponse.ok ? 'success' : 'error'}">
                        <strong>Silinen ÃœrÃ¼n:</strong> ID ${productToDelete.id} - ${productToDelete.name}<br>
                        <strong>Status:</strong> ${deleteResponse.status}<br>
                        <strong>Mesaj:</strong> ${deleteData.message || 'Bilinmeyen yanÄ±t'}<br>
                        <strong>SonuÃ§:</strong> ${deleteResponse.ok ? 'âœ… BaÅŸarÄ±lÄ±' : 'âŒ BaÅŸarÄ±sÄ±z'}
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">âŒ Hata: ${error.message}</div>`;
            }
        }
        
        function openFrontend() {
            window.open('http://localhost:3001', '_blank');
        }
        
        function clearAllCache() {
            localStorage.clear();
            sessionStorage.clear();
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }
            document.getElementById('debugInfo').innerHTML = '<div class="result success">âœ… TÃ¼m cache\'ler temizlendi</div>';
        }
        
        function debugFrontend() {
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.innerHTML = `
                <div class="result">
                    <strong>ğŸ” Frontend Debug Kontrol Listesi:</strong><br><br>
                    
                    <strong>1. Browser Developer Tools:</strong><br>
                    â€¢ F12 ile aÃ§Ä±n<br>
                    â€¢ Network sekmesinde DELETE isteklerini izleyin<br>
                    â€¢ Console'da hatalarÄ± kontrol edin<br><br>
                    
                    <strong>2. React DevTools:</strong><br>
                    â€¢ Components sekmesinde ProductsPage'i bulun<br>
                    â€¢ productToDelete state'ini kontrol edin<br>
                    â€¢ products array'inde ID'leri kontrol edin<br><br>
                    
                    <strong>3. Network Ä°zleme:</strong><br>
                    â€¢ ÃœrÃ¼n listesi yÃ¼klenirken /api/products isteÄŸini izleyin<br>
                    â€¢ Silme butonuna tÄ±klarken DELETE isteÄŸini izleyin<br>
                    â€¢ Ä°stek URL'inde hangi ID'nin gÃ¶nderildiÄŸini kontrol edin<br><br>
                    
                    <strong>4. Console KomutlarÄ±:</strong><br>
                    â€¢ <code>localStorage.getItem('products')</code><br>
                    â€¢ <code>sessionStorage.getItem('products')</code><br>
                    â€¢ React Query cache'ini kontrol edin
                </div>
            `;
        }
        
        // Sayfa yÃ¼klendiÄŸinde otomatik test
        window.onload = function() {
            testCurrentProducts();
        };
    </script>
</body>
</html>